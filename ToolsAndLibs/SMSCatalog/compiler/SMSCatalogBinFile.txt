Описание формата бинарного файла СМС каталога v.1.1

Автор: И.А.Мазница
Дата: 14/10/2005

Формат файла

--------------------------
       Заголовок
--------------------------
       Блок строк
--------------------------
  Таблица совместимости
--------------------------
       Блок данных
--------------------------
 Таблица смещений ресурсов
--------------------------
       Блок ресурсов
--------------------------

USHORT Версия компилятора "0x12"
UBYTE Флаги
    FLAG_STRINGS_UTF8 = 1 - блок строк в формате UTF8 иначе байтовое представление

LONG Дата действия каталога (включительно) в виде количества миллисекунд с 01.01.1970. 0 - нет ограничения.

USHORT Размер блока строк
USHORT Размер блока данных
USHORT Размер таблицы смещения ресурсов
USHORT Размер таблицы совместимости

Блок строк
------------
USHORT Количество строк

Нуль оканчивающиеся строки в формате
на один символ отводится байт

Таблица совместимости
------------
записи в формате

USHORT - Индекс VENDOR
UBYTE - количество индексов в записи
USHORT[] -  индексы из блока строк

Блок данных
--------------------

Служебные данные
------------
ClientID USHORT - номер строки идентифицирующей клиента (0xFFFF - если нет строки)
URL USHORT - номер строки идентифицирующей URL каталога (0xFFFF - если нет строки)
CommonSMSNum USHORT - номер строки идентифицирующей SMS номер по умолчанию (0xFFFF - если нет строки)
CommonCost USHORT - номер строки идентифицирующей цену по умолчанию (0xFFFF - если нет строки)
Send2Friend USHORT - номер SMS для отправки акции "Отправь другу" (0xFFFF - если нет строки)
Advertisment USHORT - номер текста рекламы (0xFFFF - если нет строки)
AdvertismentValidity LONG - дата конца валидности рекламы (0 - если нет конца валидности)

Экраны
-------------
ScreenName USHORT - номер строки идентификатора экрана
ScreenFlags UBYTE - флаги экрана
    FLAG_ITEMS = 1 - флаг показывает что есть контент
    FLAG_LINKS = 2 - флаг показывает что есть ссылки на другие экраны

ContentType UBYTE - тип контента по умолчанию
    0 - не определен
    1 - Игры
    2 - Звуки
    3 - Картинки
    4 - SMS Услуги

ComponentsNumber UBYTE - количество компонент на экране

Компоненты
-------------
ComponentID UBYTE - идентификатор компонента
    0 - Линк
    1 - Контент
ComponentName USHORT - номер строки идентификатора компонента

Формат линка
-----------------
    UBYTEhi
    UBYTElo

Формат контента
-----------------
    ResID USHORT - индекс строки идентификатора контента (0xFFFF - если нет строки)
    ReferenceID USHORT - индекс строки описания контента (0xFFFF - если нет строки)
    CostID USHORT - индекс строки описания стоимости контента (0xFFFF - если нет строки)
    SmsNumID USHORT - индекс строки с номером смс (0xFFFF - если нет строки)

    ResourceLink USHORT - ссылка на строку, содержащую ресурс к данному контенту (0xFFFF - нету) - если старший бит установлен то это индекс ресурса в пуле

(? если не определен тип контента экрана) ContentType UBYTE - тип контента
            0 - не определен
            1 - Игры
            2 - Звуки
            3 - Картинки
            4 - SMS услуга

    UBYTE количество ссылок на записи совместимости (0 - если нету)

    ссылки на запись в таблице совместимости
    USHORT - смещение в таблице совместимостей в байтах

Таблица смещения ресурсов
------------
USHORT - количество индексов
USHORT -  смещения до каждого ресурса от начала блока ресурсов

Блок ресурсов
-------------------
записи

USHORT - размер блока данных
BYTE[] - Блок данных
...
