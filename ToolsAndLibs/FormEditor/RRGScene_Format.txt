Описание структуры файла RRG Scene

Версия: 1.00b
Автор: И.А.Мазница
Дата: 24-авг-04

Введение

Данный файл представляет собой контейнер, содержащий графическую, звуковую и текстовую информацию, которая может быть отображена на графическом устройстве при помощи парсера, поддерживающего данный формат.

Формат

|-------------------------|
Заголовок
|-------------------------|
Секция IMAGES
|-------------------------|
Секция SOUNDS
|-------------------------|
Секция TEXTS
|-------------------------|
Секция FONTS
|-------------------------|
Секция FORMS
|-------------------------|

Заголовок

Поле	            Описание	                    Формат
Label 	            Идентификатор файла 0xFFDD	    USHORT
Version	            Номер версии 0x0100	            USHORT
Size	            Размер файла в байтах	        3 bytes
Flags	            Служебые флаги	                UBYTE
Section flags	    Флаги наличия секций	        UBYTE
Offset IMAGES	    Смещение до секции IMAGES	    3 bytes
Offset SOUNDS	    Смещение до секции SOUNDS	    3 bytes
Offset TEXTS	    Смещение до секции TEXTS	    3 bytes
Offset FONTS	    Смещение до секции FONTS	    3 bytes
Offset FORMS        Смещение до секции FORMS	    3 bytes

Смещение до секции в случае её отсутствия или использования только идентификаторов для заданного вида ресурсов содержит нулевое значение.

Перед каждой секцией записывается её размер в формате VLQ

Служебные флаги

SERVICE_FLAG_CHANNELS_EXIST = 1; флаг показывающий что присутствует информация о каналах
SERVICE_FLAG_OFFSETS_EXIST = 2; флаг показывающий что присутствует информация о смещениях
SERVICE_FLAG_IMAGE_TYPES = 4; флаг показывающий что присутствует информация о типах изображений
SERVICE_FLAG_SOUNDS_TYPES = 8; флаг показывающий что присутствует информация о типах звуков
SERVICE_FLAG_FONTS_TYPES = 16; флаг показывающий что присутствует информация о типах фонтов

Флаги наличия секций:

    SECTION_FLAG_FORM = 1;
    SECTION_FLAG_IMAGES = 2;
    SECTION_FLAG_SOUNDS = 4;
    SECTION_FLAG_TEXTS = 8;
    SECTION_FLAG_FONTS = 16;

Смещение до секции рассчитывается от начала файла.


Секция IMAGES

Поле	Описание	Формат
ImagesNumber	Количество сохраненных изображений	UBYTE
PoolID	Идентификатор изображения	UBYTE
*ImageType	Тип хранимого изображения	UBYTE
DataSize	Размер данных 	VLQ
ImageData	Данные изображения	BYTE[]

Секция SOUNDS

Поле	Описание	Формат
SoundsNumber	Количество сохраненных звуков	UBYTE
PoolID	Идентификатор звука	UBYTE
*SoundType	Тип хранимого звука	UBYTE
TimeLength	Время звучания в миллисекундах	VLQ
DataSize	Размер данных 	VLQ
SoundData	Данные звука	BYTE[]

Секция TEXTS

Поле	Описание	Формат
StringsNumber	Количество сохраненных строк	UBYTE
PoolID	Идентификатор строки	UBYTE
String	Данные строки в UTF8	UTF8[]

Секция FONTS

Поле	Описание	Формат
FontsNumber	Количество сохраненных фонтов	UBYTE
PoolID	Идентификатор фонта	UBYTE
*FontType	Тип хранимого фонта	UBYTE
DataSize	Размер данных 	VLQ
FontData	Данные фонта	BYTE[]

Секция FORMS

|-------------------------------|
    Количество форм UBYTE
|-------------------------------|
    Секции FORM
|-------------------------------|

Секция FORM

|-------------------------------|
  Заголовок
|-------------------------------|
  Секция COMPONENTS
|-------------------------------|

Поле	            Описание	                    Формат
ID	                идентификатор формы             UBYTE
Channel	            Канал формы	                    UBYTE
Width	            Ширина в пикселях	            USHORT
Height	            Высота в пикселях	            USHORT
ColorBCKG	        Цвет фона	                    3 bytes
ColorSLCTD	        Цвет выбранного текста	        3 bytes
ColorPRSD	        Цвет нажатого текста	        3 bytes
ColorDSBLD	        Цвет запрещенного текста	    3 bytes

Секция COMPONENTS

|----------------------------------|
    Количество комонент (UBYTE)
|----------------------------------|
    Component
|----------------------------------|
    …
|----------------------------------|
    Component
|----------------------------------|

Заголовок Component

Поле	            Описание	                Формат
ComponentType	    Тип компонента	            UBYTE
ComponentID	        Идентификатор компонента	UBYTE
*ComponentChannel	Канал компонента	        UBYTE
CoordX	            Координата X	            SHORT
CoordY	            Координата Y	            SHORT
Width	            Ширина компонента	        USHORT
Height	            Высота компонента	        USHORT

ComponentType = [0|1|2]

0 – Image
1 – Button
2 – Label

ComponentID [0..255]

Компонент Image

Поле	            Описание	                                    Формат
ResourceID	        Идентификатор изображения в секции Images	    UBYTE

ScaleFactor	        Коэффициент увеличения картинки	                UBYTE

Modifiers	        Модификаторы картинки	                        UBYTE

*ResourceOffset	    Смещение до ресурсного изображения
                    в секции Images от начала секции	            USHORT

ScaleFactor = 1…255

Modifiers

MODIFIER_NONE = 0;
    	MODIFIER_FLIP_HORZ = 1; горизонтальное зеркалирование
    	MODIFIER_FLIP_VERT = 2; вертикальное зеркалирование

Компонент Label

Поле	            Описание	                    Формат
Color	            Цвет метки	                    3 bytes

TextID	            Идентификатор текста	        UBYTE

*TextOffset	        Смещение до ресурсной строки
                    в секции Texts от начала секции	USHORT

FontID	            Идентификатор фонта	            UBYTE

*FontOffset	        Смещение до ресурсного фонта в
                    секции Fonts от начала секции	USHORT

Компонент Button

Поле	                                    Описание	                                    Формат
Image Normal ID	                            Идентификатор в пуле картинки описывающей
                                            нормальное состояние. Эта картинка является
                                            основной и заменяет неопределенные картинки.	UBYTE

Image Normal Offset	                        Смещение в пуле картинок до блока данных
                                            описывающих картинку нормального состояния.	    USHORT

Image Selected ID	                        Идентификатор в пуле картинки описывающей
                                            выбранное состояние. 	                        UBYTE

Image Selected Offset	                    Смещение в пуле картинок до блока данных
                                            описывающих картинку выбранного состояния.	    USHORT

Image Disabled ID	                        Идентификатор в пуле картинки описывающей
                                            запрещенное состояние. 	                        UBYTE

Image Disabled Offset	                    Смещение в пуле картинок до блока данных
                                            описывающих картинку запрещенного состояния.	USHORT

Image Pressed ID	                        Идентификатор в пуле картинки описывающей
                                            нажатое состояние.	                            UBYTE

Image Pressed Offset	                    Смещение в пуле картинок до блока данных
                                            описывающих картинку нажатого состояния.	    USHORT

Text ID	                                    Идентификатор в пуле текста,
                                            отображаемого на кнопке.	                    UBYTE

Text Offset	                                Смещение в пуле текста до данных
                                            описывающих текст кнопки.	                    USHORT

Text align flag	                            Флаги выравнивания текста на кнопке.	        UBYTE

Font ID	                                    Идентификатор в пуле фонта, отображающего
                                            текст на кнопке.	                            UBYTE

Font offset	                                Смещение в пуле фонтов до данных
                                            описывающих фонт.	                            USHORT

Click sound ID	                            Идентификатор в пуле звуков проигрываемого
                                            при нажатии кнопки.	                            UBYTE

Click sound offset	                        Смещение в пуле звуков до данных описывающих
                                            звук нажатия кнопки.	                        USHORT

