Описание формата Mobile Compound Image

Версия 2.5
Автор И.А.Мазница

Файл представляет из себя последовательно сохраненные формы и их компоненты,а
в конце файла хранятся изображения на которые ссылаются компоненты.

Формат
------------
Версия формата UBYTE (0x10)

Количество форм-1 UBYTE (0-одна форма)
Флаги UBYTE
    FLAG_HASMODIFIEDIMAGES = 1; флаг наличия модифицируемых изображений
    FLAG_IMAGES_ONLY = 2; флаг, что хранятся только изображения
    FLAG_CHANNELDATA = 4; флаг, что присутствует информация о канале
    FLAG_STRINGS = 8; флаг, что присутствуют тексты
    FLAG_FONTS = 16; флаг, что присутствуют фонты
    FLAG_HASANCHOR = 32; флаг, что присутствует информация о якорях
    FLAG_PATHS = 64; флаг, что присутствует информация о путях

Размер блока форм USHORT

Блок форм
------------------
Форма 0
------------------
Форма 1
------------------
...
Форма N

Формат хранения формы

Цвет фона RGB:
Red   UBYTE
Green UBYTE
Blue  UBYTE

Размеры формы
Width-1  UBYTE
Height-1 UBYTE

Количество компонент UBYTE

Блок компонентов
------------------------
Компонент 0
------------------------
Компонент 1
------------------------
....
Компонент N

Формат хранения компонента

(?) Тип компонента UBYTE:
0x80 - бит флаг запроса отображения компонента
Тип компонента
0 - Image, 1 - ClipArea, 2 - Button, 3-TextLabel

Координата X UBYTE
Координата Y UBYTE
(?) Channel UBYTE

(?)Координатный якорь UBYTE (показывает, координаты какой точки приведены)
ANCHOR_LEFT = 4 левая
ANCHOR_RIGHT = 8 правая
ANCHOR_TOP = 16 верхняя
ANCHOR_BOTTOM = 32 нижняя

Компонента ClipArea
------------------
Ширина UBYTE
Высота UBYTE

Компонента Кнопка
------------------
Индекс картинки "NORMAL" UBYTE
Индекс картинки "FOCUSED" UBYTE
Индекс картинки "PRESSED" UBYTE
Индекс картинки "DISABLED" UBYTE

Компонента Image
------------------
(!)Если выставлен флаг модификаторов то поле модификатора
    MODIFIER_NONE = 0; нет модификатора
    MODIFIER_FLIP_HORZ = 1; отзеркалирован по горизонтали
    MODIFIER_FLIP_VERT = 2; отзеркалирован по вертикали

Индекс картинки в пуле картинок UBYTE

Компонента TextLabel

Индекс фонта в пуле фонтов UBYTE
Индекс текстовой строки в пуле строк UBYTE
Цветовая составляющая R UBYTE
Цветовая составляющая G UBYTE
Цветовая составляющая B UBYTE

каждый символ упаковывается в формат
X смещение в символах на картинке и Y смещение в строках до строки содержащей символ

Блок строк (необязателен)
--------------------
количество строк UBYTE

Таблица смещений  данных строк в массиве (первая строка 0) USHORT[...]

размер блока данных USHORT
Строка 0
...
Строка N

Формат

Длинна-1 UBYTE
Символы UBYTE[...]
Каждый символ представлен двумя индексами X и Y в картинке фонта, Y - старшие 4 разряда, а X - младшие, для получения смещения надо их умножить на ширину и высоту символа

Блок фонтов (необязателен)
--------------------
Количество фонтов UBYTE

----------
Фонт 1
----------
.....
----------
Фонт 7
----------

Каждый фонт хранится в следующем формате

Индекс картинки, содержащей фонт в массиве картинок UBYTE
Ширина картинки буквы UBYTE
Высота картинки буквы UBYTE
Зазор между буквами по горизонтали картинки UBYTE
Зазор между буквами по вертикали картинки UBYTE

Блок путей
-----------
Количество путей-1 UBYTE
Размер в ячейках данных, блока путей USHORT

Путь 1
....
Путь N

Формат хранения пути

Флаг UBYTE
PATHFLAG_SHORT = 1 - показывает что данные точек пути в формате SHORT, иначе UBYTE
PATHFLAG_HASBOUNDARYINFO = 2 - показывает что имеются данные о границах
PATHFLAG_HASMAINPOINTINFO = 4 - показывает что имеются данные о координатах главной точки
PATHFLAG_HASSTEPSINFO = 8 - показывает что имеются данные о количестве шагов на участке

тип пути и флаги событий UBYTE

EVENT_EVERYPOINT 0x10 - флаг посылки события при прохождении каждой точки
EVENT_ENDPOINT 0x20 - флаг посылки события при достижении последней точки

PATHTYPE_NORMAL 0 - обычный путь, спрайт доходит до конца пути и работа контроллера прекращается
PATHTYPE_PENDULUM 1 - маятник, спрайт доходит до конца пути и начинает двигаться в обратном направлении
PATHTYPE_CYCLED_SMOOTH 2 - зацикленный, спрайт ходит по кругу, с плавным переходом с конечной точки на стартовую
PATHTYPE_CYCLED 3 - зацикленный, спрайт ходит по кругу

(?) BOUNDARYINFO информация о размерах описывающего путь прямоугольника в пикселях
width UBYTE | SHORT
height UBYTE | SHORT

(?) MAINPOINTINFO информация о координатах главной точки, если нет то по умолчанию она считается в нулевых координатах
x UBYTE | SHORT
y UBYTE | SHORT

количество точек пути-1 UBYTE

точка1
...
точка2

формат хранения информации о точке
x UBYTE | SHORT координата X
y UBYTE | SHORT координата Y
(?) steps UBYTE | SHORT количество шагов на участке до следующей точки

Блок изображений
---------------------
Количество изображений USHORT
Размер максимального пакованного изображения в байтах USHORT
Размер блока изображений USHORT

------------------
Изображение 0
------------------
Изображение 1
------------------
...
Изображение N

Каждое изображение хранится в следующем формате
Размер данных изображения USHORT
Данные изображения BYTE[]